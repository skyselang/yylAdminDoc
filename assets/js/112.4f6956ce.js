(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{445:function(a,t,s){"use strict";s.r(t);var e=s(8),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"定时任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定时任务"}},[a._v("#")]),a._v(" 定时任务")]),a._v(" "),t("h3",{attrs:{id:"添加定时操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加定时操作"}},[a._v("#")]),a._v(" 添加定时操作")]),a._v(" "),t("p",[a._v("在 app\\command\\Timer 的 start 方法中添加需要定时执行的操作"),t("br"),a._v("\napp\\command\\Timer")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 会员日志清除")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name static-context"}},[a._v("LogService")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("clearLog")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("catch")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name class-name-fully-qualified"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Exception")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$e")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[a._v("'timer member-log-clear '")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(".")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$e")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(".")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("PHP_EOL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h3",{attrs:{id:"开启定时任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启定时任务"}},[a._v("#")]),a._v(" 开启定时任务")]),a._v(" "),t("h4",{attrs:{id:"开发模式开启"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开发模式开启"}},[a._v("#")]),a._v(" 开发模式开启")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("php think timer\n")])])]),t("blockquote",[t("p",[a._v("debug 模式，开发调试使用")])]),a._v(" "),t("h4",{attrs:{id:"守护进程方式开启"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#守护进程方式开启"}},[a._v("#")]),a._v(" 守护进程方式开启")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("php think timer "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--mode")]),a._v(" d\n")])])]),t("blockquote",[t("p",[a._v("daemon 模式，正式部署使用")])]),a._v(" "),t("h4",{attrs:{id:"守护进程并设置间隔时间开启"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#守护进程并设置间隔时间开启"}},[a._v("#")]),a._v(" 守护进程并设置间隔时间开启")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("php think timer "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--mode")]),a._v(" d "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--interval")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])])]),t("blockquote",[t("p",[a._v("--interval 1，间隔时间为1秒，即每秒执行一次"),t("br"),a._v("\n设置：开启时传入参数或在 app\\command\\Timer 修改")])]),a._v(" "),t("h3",{attrs:{id:"查看定时任务参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看定时任务参数"}},[a._v("#")]),a._v(" 查看定时任务参数")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("php think timer "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--help")]),a._v("\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("Usage:\n  timer "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("--"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("action"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\nArguments:\n  action                     start"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("stop"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("restart"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("reload"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("status"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("connections "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("default: "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"start"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\nOptions:\n  -m, --mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("MODE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("          daemon（守护进程）方式启动\n  -i, --interval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("INTERVAL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("  多长时间执行一次\n  -h, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--help")]),a._v("                 Display this "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("help")]),a._v(" message\n  -V, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v("              Display this console version\n  -q, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--quiet")]),a._v("                Do not output any message\n      "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--ansi")]),a._v("                 Force ANSI output\n      --no-ansi              Disable ANSI output\n  -n, --no-interaction       Do not ask any interactive question\n  -v"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("vv"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("vvv, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--verbose")]),a._v("       Increase the verbosity of messages: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" normal output, "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" verbose output and "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" debug\n")])])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),t("p",[a._v("确保执行命令的用户有足够权限或添加 sudo")])])])}),[],!1,null,null,null);t.default=r.exports}}]);